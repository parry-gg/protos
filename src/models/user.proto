// User profile and account management.
// Handles user identity, profile information, and associated visual assets.
syntax = "proto3";

option java_multiple_files = true;
option java_package = "gg.parry.grpc.models";

package parrygg.models;

import "models/image.proto";
import "google/protobuf/timestamp.proto";

// User represents a platform user account with profile information.
// Contains identity, contact, and personalization details.
// Next id: 15
message User {
  // Unique identifier for the user (UUID v7).
  string id = 1;
  // Public gaming handle/username.
  string gamer_tag = 2;
  // User's first name.
  string first_name = 3;
  // User's last name.
  string last_name = 4;
  // Markdown-formatted biography/description.
  string bio_md = 5;
  // Preferred pronouns (e.g., "they/them").
  string pronouns = 6;
  // URL to user's avatar image.
  string avatar_url = 7;
  // Hex color code for profile banner.
  string banner_color = 8;
  // Country of residence.
  string location_country = 9;
  // State/province of residence.
  string location_state = 10;
  // City of residence.
  string location_city = 11;
  // Profile images (avatars, banners, etc.).
  repeated Image images = 12;
  // Whether this user is anonymous (not connected to a real account)
  bool is_anonymous = 13;
  // Linked external accounts (Discord, start.gg, etc.).
  repeated LinkedAccount linked_accounts = 14;
}

// MutableUser updates editable fields of a user profile.
// Subset of User with fields that may be mutated by a request.
// Next id: 11
message MutableUser {
  // Updated gamer tag.
  optional string gamer_tag = 1;
  // Updated first name.
  optional string first_name = 2;
  // Updated last name.
  optional string last_name = 3;
  // Updated bio in markdown format.
  optional string bio_md = 4;
  // Updated pronouns.
  optional string pronouns = 5;
  // Updated avatar image ID.
  optional string avatar_image_id = 6;
  // Updated banner color.
  optional string banner_color = 7;
  // Updated country.
  optional string location_country = 8;
  // Updated state/province.
  optional string location_state = 9;
  // Updated city.
  optional string location_city = 10;
}

// Supported OAuth providers for account linking
enum LinkedAccountProvider {
  LINKED_ACCOUNT_PROVIDER_UNSPECIFIED = 0;
  LINKED_ACCOUNT_PROVIDER_DISCORD = 1;
  LINKED_ACCOUNT_PROVIDER_STARTGG = 2;
}

// LinkedAccount represents an external account linked to a user.
// Contains information about connected third-party services.
// Next id: 5
message LinkedAccount {
  // Provider (e.g., LINKED_ACCOUNT_PROVIDER_DISCORD, LINKED_ACCOUNT_PROVIDER_STARTGG).
  LinkedAccountProvider provider = 1;
  // User ID on the external provider.
  string user_id = 2;
  // Username on the external provider.
  string username = 3;
  // URL slug for the provider profile (e.g., start.gg slug).
  string slug = 4;
}

message LinkAccountAction {
  LinkedAccount linked_account = 1;
}

message UnlinkAccountAction {
  LinkedAccountProvider provider = 1;
}

// MergeUserAction represents information about the merging of a prior parry.gg User into a still-existing User.
message MergeUserAction {
  // The prior user which was merged into the user in question.
  string from_user_id = 1;
}

enum IdentityActionType {
  IDENTITY_ACTION_TYPE_UNSPECIFIED = 0;
  IDENTITY_ACTION_TYPE_LINK = 1;
  IDENTITY_ACTION_TYPE_UNLINK = 2;
  IDENTITY_ACTION_TYPE_MERGE = 3;
}

// IdentityAction represents a past action taken affecting a user's identity.
message IdentityAction {
  // Unique identifier for this action (UUID v7).
  string id = 1;
  // The id of the affected user.
  string user_id = 2;
  // Time at which this action occurred.
  google.protobuf.Timestamp created_at = 3;
  // Type-specific action data.
  oneof type {
    // Linking an external account.
    LinkAccountAction link_account_action = 4;
    // Unlinking an external account.
    UnlinkAccountAction unlink_account_action = 5;
    // Merging a parry.gg user.
    MergeUserAction merge_user_action = 6;
  }

}

