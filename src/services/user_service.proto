// User profile management service.
// Provides operations for user accounts, profiles, and search functionality.
syntax = "proto3";

option java_multiple_files = true;
option java_package = "gg.parry.grpc.services";

package parrygg.services;

import "models/user.proto";
import "models/event.proto";
import "models/image.proto";
import "models/filter.proto";
import "models/pagination.proto";
import "google/protobuf/timestamp.proto";

message GetUserRequest {
  oneof identifier {
    string id = 1;

  }
}

message GetUserResponse {
  parrygg.models.User user = 1;
}

message GetUsersRequest {
  parrygg.models.UsersFilter filter = 1;
}

message GetUsersResponse {
  repeated parrygg.models.User users = 1;
}

message UpdateUserRequest {
  string id = 1;
  parrygg.models.MutableUser user = 2;
}

message UpdateUserResponse {
  parrygg.models.User user = 1;
}

message GetUserPlacementsRequest {
  string id = 1;
  parrygg.models.PaginationRequest pagination_request = 2;

}

message GetUserPlacementsResponse {
  repeated parrygg.models.EntrantResult results = 1;
  parrygg.models.PaginationResponse pagination_response = 2;
}

message GetIdentityActionsRequest {
  optional google.protobuf.Timestamp timestamp_since = 1;
}

message GetIdentityActionsResponse {
  repeated parrygg.models.IdentityAction actions = 1;
}

service UserService {
  // Retrieves a user by ID or Keycloak entity ID.
  rpc GetUser (GetUserRequest) returns (GetUserResponse) {}
  
  // Retrieves multiple users based on filter criteria.
  rpc GetUsers (GetUsersRequest) returns (GetUsersResponse) {}
  
  // Updates an existing user profile.
  rpc UpdateUser (UpdateUserRequest) returns (UpdateUserResponse) {}

  // Retrieves a user's recent placement data
  rpc GetUserPlacements (GetUserPlacementsRequest) returns (GetUserPlacementsResponse) {}

  // Retrieves the history of actions affecting any user accounts after a given point in time.
  rpc GetIdentityActions (GetIdentityActionsRequest) returns (GetIdentityActionsResponse) {}
  
}
